---
title: "NanoBRET Processing"
author: "Matthew Berginski"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(htmltab)
library(DarkKinaseTools)
library(tidyverse)
library(here)
library(janitor)
```


```{r load}
NanoBRET_page = "https://www.promega.com/products/cell-signaling/kinase-target-engagement/nanobret-te-intracellular-kinase-assay/?catNum=N2520&accordion0=0&accordion1=0"

dark_NanoBRET_assays <- htmltab(doc = NanoBRET_page, which=1) %>%
  clean_names() %>%
  filter(gene_name %in% dark_kinases$symbol) %>%
  rename(symbol = gene_name) %>%
  mutate(fusion_name = str_match(vector_name, "(.*?) ")[,2]) %>%
  select(symbol,vector_catalog_number,fusion_name)

#I couldn't figure out how to programmatically grab the list that appears below
#the main list, so I copied it out manually and saved it.
other_kinases = read_csv(here('NanoBRET/additional_kinases.csv'), col_names = F)
for (this_col in names(other_kinases)) {
  hits_in_column = other_kinases[[this_col]][which(other_kinases[[this_col]] %in% dark_kinases$symbol)]
  dark_NanoBRET_assays = dark_NanoBRET_assays %>% 
    add_row(symbol = hits_in_column,
            vector_catalog_number = "Special Request",
            fusion_name = paste0("NanoLucÂ®-fused ",hits_in_column))
}

dark_NanoBRET_assays = dark_NanoBRET_assays %>%
  mutate(vector_url = ifelse(vector_catalog_number == "Special Request",
                             "https://www.promega.com/products/cell-signaling/kinase-target-engagement/nanobret-te-intracellular-kinase-assay/?catNum=N2520&accordion1=0",
                             paste0('https://www.promega.com/catalogredirection.aspx?partno=',vector_catalog_number)))

tracer_info = read_csv(here('NanoBRET/NanoBRET_tracer_info.csv')) %>%
  mutate(tracer_catalog_number = 
           case_when(
             tracer_id == "K-5" ~ "N248A",
             TRUE ~ "NA"
           )) %>% 
  mutate(concentration = paste0(concentration, ' \u00B5M'))

dark_NanoBRET_assays = dark_NanoBRET_assays %>% left_join(tracer_info)

write_csv(dark_NanoBRET_assays,here('NanoBRET/dark_NanoBRET_promega.csv'))
```

